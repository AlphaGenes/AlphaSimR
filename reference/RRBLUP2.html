<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>RR-BLUP Model 2 — RRBLUP2 • AlphaSimR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="RR-BLUP Model 2 — RRBLUP2" />
<meta property="og:description" content="Fits an RR-BLUP model for genomic predictions. This implementation is 
meant for situations where RRBLUP is too slow. Note that 
RRBLUP2 is only faster in certain situations, see details below. Most 
users should use RRBLUP." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AlphaSimR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/intro.html">Introduction to AlphaSimR</a>
    </li>
    <li>
      <a href="../articles/traits.html">Traits in AlphaSimR</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/gaynorr/AlphaSimR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>RR-BLUP Model 2</h1>
    <small class="dont-index">Source: <a href='https://github.com/gaynorr/AlphaSimR/blob/master/R/GS.R'><code>R/GS.R</code></a></small>
    <div class="hidden name"><code>RRBLUP2.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits an RR-BLUP model for genomic predictions. This implementation is 
meant for situations where <code><a href='RRBLUP.html'>RRBLUP</a></code> is too slow. Note that 
RRBLUP2 is only faster in certain situations, see details below. Most 
users should use <code><a href='RRBLUP.html'>RRBLUP</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>RRBLUP2</span><span class='op'>(</span>
  <span class='va'>pop</span>,
  traits <span class='op'>=</span> <span class='fl'>1</span>,
  use <span class='op'>=</span> <span class='st'>"pheno"</span>,
  snpChip <span class='op'>=</span> <span class='fl'>1</span>,
  useQtl <span class='op'>=</span> <span class='cn'>FALSE</span>,
  maxIter <span class='op'>=</span> <span class='fl'>10</span>,
  Vu <span class='op'>=</span> <span class='cn'>NULL</span>,
  Ve <span class='op'>=</span> <span class='cn'>NULL</span>,
  useEM <span class='op'>=</span> <span class='cn'>TRUE</span>,
  tol <span class='op'>=</span> <span class='fl'>1e-06</span>,
  useReps <span class='op'>=</span> <span class='cn'>FALSE</span>,
  simParam <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>pop</th>
      <td><p>a <code><a href='Pop-class.html'>Pop-class</a></code> to serve as the training population</p></td>
    </tr>
    <tr>
      <th>traits</th>
      <td><p>an integer indicating the trait to model or a
function of the traits returning a single value. Unlike <code><a href='RRBLUP.html'>RRBLUP</a></code>, 
only univariate models are supported.</p></td>
    </tr>
    <tr>
      <th>use</th>
      <td><p>train model using phenotypes "pheno", genetic values "gv", 
estimated breeding values "ebv", breeding values "bv", or randomly "rand"</p></td>
    </tr>
    <tr>
      <th>snpChip</th>
      <td><p>an integer indicating which SNP chip genotype 
to use</p></td>
    </tr>
    <tr>
      <th>useQtl</th>
      <td><p>should QTL genotypes be used instead of a SNP chip. 
If TRUE, snpChip specifies which trait's QTL to use, and thus these 
QTL may not match the QTL underlying the phenotype supplied in traits.</p></td>
    </tr>
    <tr>
      <th>maxIter</th>
      <td><p>maximum number of iterations.</p></td>
    </tr>
    <tr>
      <th>Vu</th>
      <td><p>marker effect variance. If value is NULL, a 
reasonable starting point is chosen automatically.</p></td>
    </tr>
    <tr>
      <th>Ve</th>
      <td><p>error variance. If value is NULL, a 
reasonable starting point is chosen automatically.</p></td>
    </tr>
    <tr>
      <th>useEM</th>
      <td><p>use EM to solve variance components. If false, 
the initial values are considered true.</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>tolerance for EM algorithm convergence</p></td>
    </tr>
    <tr>
      <th>useReps</th>
      <td><p>should population's reps slot be used to model 
heterogeneous error variance</p></td>
    </tr>
    <tr>
      <th>simParam</th>
      <td><p>an object of <code><a href='SimParam.html'>SimParam</a></code></p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments if using a function for 
traits</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The RRBLUP2 function works best when the number of markers is not 
too large. This is because it solves the RR-BLUP problem by setting 
up and solving Henderson's mixed model equations. Solving these equations 
involves a square matrix with dimensions equal to the number of fixed 
effects plus the number of random effects (markers). Whereas the <code><a href='RRBLUP.html'>RRBLUP</a></code> 
function solves the RR-BLUP problem using the EMMA approach. This approach involves 
a square matrix with dimensions equal to the number of phenotypic records. This means 
that the RRBLUP2 function uses less memory than RRBLUP when the number of markers 
is approximately equal to or smaller than the number of phenotypic records.</p>
<p>The RRBLUP2 function is not recommend for cases where the variance components are 
unknown. This is uses the EM algorithm to solve for unknown variance components, 
which is generally considerably slower than the EMMA approach of <code><a href='RRBLUP.html'>RRBLUP</a></code>. 
The number of iterations for the EM algorith is set by maxIter. The default value 
is typically too small for convergence. When the algorithm fails to converage a 
warning is displayed, but results are given for the last iteration. These results may 
be "good enough". However we make no claim to this effect, because we can not generalize 
to all possible use cases.</p>
<p>The RRBLUP2 function can quickly solve the mixed model equations without estimating variance 
components. The variance components are set by defining Vu and Ve. Estimation of components 
is suppressed by setting useEM to false. This may be useful if the model is being retrained 
multiple times during the simulation. You could run <code><a href='RRBLUP.html'>RRBLUP</a></code> function the first 
time the model is trained, and then use the variance components from this output for all 
future runs with the RRBLUP2 functions. Again, we can make no claim to the general robustness 
of this approach.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>#Create founder haplotypes</span>
<span class='va'>founderPop</span> <span class='op'>=</span> <span class='fu'><a href='quickHaplo.html'>quickHaplo</a></span><span class='op'>(</span>nInd<span class='op'>=</span><span class='fl'>10</span>, nChr<span class='op'>=</span><span class='fl'>1</span>, segSites<span class='op'>=</span><span class='fl'>20</span><span class='op'>)</span>

<span class='co'>#Set simulation parameters</span>
<span class='va'>SP</span> <span class='op'>=</span> <span class='va'><a href='SimParam.html'>SimParam</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='va'>founderPop</span><span class='op'>)</span>
<span class='va'>SP</span><span class='op'>$</span><span class='fu'>addTraitA</span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='va'>SP</span><span class='op'>$</span><span class='fu'>setVarE</span><span class='op'>(</span>h2<span class='op'>=</span><span class='fl'>0.5</span><span class='op'>)</span>
<span class='va'>SP</span><span class='op'>$</span><span class='fu'>addSnpChip</span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>

<span class='co'>#Create population</span>
<span class='va'>pop</span> <span class='op'>=</span> <span class='fu'><a href='newPop.html'>newPop</a></span><span class='op'>(</span><span class='va'>founderPop</span>, simParam<span class='op'>=</span><span class='va'>SP</span><span class='op'>)</span>

<span class='co'>#Run GS model and set EBV</span>
<span class='va'>ans</span> <span class='op'>=</span> <span class='fu'>RRBLUP2</span><span class='op'>(</span><span class='va'>pop</span>, simParam<span class='op'>=</span><span class='va'>SP</span><span class='op'>)</span>
<span class='va'>pop</span> <span class='op'>=</span> <span class='fu'><a href='setEBV.html'>setEBV</a></span><span class='op'>(</span><span class='va'>pop</span>, <span class='va'>ans</span>, simParam<span class='op'>=</span><span class='va'>SP</span><span class='op'>)</span>

<span class='co'>#Evaluate accuracy</span>
<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='fu'><a href='gv.html'>gv</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span>, <span class='fu'><a href='ebv.html'>ebv</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          [,1]
#&gt; [1,] 0.646786</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Chris Gaynor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


